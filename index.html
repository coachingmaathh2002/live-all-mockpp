<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBSLST 2025 Math Mock Test</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- MathJax Configuration and Script -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                renderActions: {
                    addMenu: [20, function (doc) {
                        if (doc.type === "HTML") {
                            const MENU = MathJax._.ui.menu.Menu;
                            MENU.defaultStyles(doc.menuStyles);
                            MENU.defaultFonts(doc.menuFont);
                        }
                    }, '']
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Libraries for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.6/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* A very light gray background */
        }
        /* Custom styles for MathJax to ensure proper alignment */
        .math {
            display: inline-block;
            vertical-align: middle;
            font-size: 1.125rem; /* Matches text-lg from Tailwind */
        }
        /* Add button hover effect */
        .btn-primary:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1-2px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
            transition: all 0.2s ease-in-out;
        }
        /* Style for the answer options */
        .option-label {
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border-width: 2px;
            border-color: #e2e8f0; /* Default border color */
            transition: all 0.2s;
        }
        .option-label:hover {
            background-color: #f7fafc; /* Lighter background on hover */
            border-color: #cbd5e0;
        }
        input[type="radio"]:checked + .option-label {
            background-color: #bfdbfe; /* Light blue when checked */
            border-color: #3b82f6; /* Blue border when checked */
        }
        .hero-bg {
            background-image: linear-gradient(to right, #4c1d95, #3b0764); /* Deep purple gradient */
        }
        .testimonial-bg {
            background-color: #1f2937; /* Dark gray for testimonials */
        }
        .testimonial-card {
            background-color: #374151; /* Slightly lighter gray for testimonial card */
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Main Dashboard Section -->
    <div id="main-dashboard-section" class="min-h-screen hero-bg text-white flex flex-col items-center">
        <!-- Hero Section -->
        <div class="text-center max-w-4xl w-full py-20 px-4 md:px-8">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 animate-fade-in-down">WBSLST 2025</h1>
            <p class="text-xl md:text-2xl text-gray-300 font-light mb-8 animate-fade-in-up">
                Practice with our free mock tests to prepare for your Math exam.
            </p>
            <button id="start-test-button" class="bg-blue-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transition-colors duration-300 btn-primary">
                Start Free Mock Test
            </button>
        </div>

        <!-- About Us Section (Updated) -->
        <div id="about-us-section" class="bg-slate-800 py-16 md:py-24 px-4 md:px-8 w-full text-white">
            <div class="max-w-4xl mx-auto text-center">
                <div class="flex justify-center mb-6">
                    <!-- SVG for a graduation cap -->
                    <svg class="w-16 h-16 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21.5 8.01L12 3.51L2.5 8.01L12 12.51L21.5 8.01ZM21.5 10.01L12 14.51L2.5 10.01V12.01L12 16.51L21.5 12.01V10.01ZM21.5 14.01L12 18.51L2.5 14.01V16.01L12 20.51L21.5 16.01V14.01Z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">About Our Portal</h2>
                <p class="text-lg md:text-xl text-gray-300 leading-relaxed mb-4">
                    Welcome to the Advanced Math Mock Test Portal, your one-stop solution for comprehensive exam preparation. Our platform is designed to help students master various mathematical concepts through a wide range of mock tests tailored for specific competitive exams.
                </p>
                <p class="text-lg md:text-xl text-gray-300 leading-relaxed">
                    We provide a structured learning experience with carefully curated practice tests, helping you to identify your strengths and weaknesses. Dive into our extensive library of questions and prepare yourself to ace your exams with confidence!
                </p>
            </div>
        </div>

        <!-- Testimonials Section -->
        <div id="testimonials-section" class="testimonial-bg text-white py-16 md:py-24 px-4 md:px-8 w-full">
            <div class="max-w-5xl mx-auto">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-10">What Our Students Say</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-8">
                    <!-- Testimonial Card 1 -->
                    <div class="testimonial-card p-6 rounded-xl shadow-xl flex flex-col h-full">
                        <p class="text-lg text-gray-300 italic mb-4">
                            "The mock tests here are top-notch and a real confidence booster. I feel much more prepared for the SLST exam."
                        </p>
                        <div class="mt-auto">
                            <p class="font-semibold text-white">Ananya Majumdar</p>
                            <p class="text-sm text-gray-400">SLST Math Aspirant</p>
                        </div>
                    </div>
                    <!-- Testimonial Card 2 -->
                    <div class="testimonial-card p-6 rounded-xl shadow-xl flex flex-col h-full">
                        <p class="text-lg text-gray-300 italic mb-4">
                            "The questions are very relevant to the syllabus. This platform has been instrumental in my revision strategy."
                        </p>
                        <div class="mt-auto">
                            <p class="font-semibold text-white">Somnath Ghosh</p>
                            <p class="text-sm text-gray-400">SLST Math Aspirant</p>
                        </div>
                    </div>
                    <!-- Testimonial Card 3 -->
                    <div class="testimonial-card p-6 rounded-xl shadow-xl flex flex-col h-full">
                        <p class="text-lg text-gray-300 italic mb-4">
                            "I love the one-by-one question format. It helps me focus on each problem without feeling overwhelmed. Highly recommended!"
                        </p>
                        <div class="mt-auto">
                            <p class="font-semibold text-white">Priya Roy</p>
                            <p class="text-sm text-gray-400">SLST Math Aspirant</p>
                        </div>
                    </div>
                    <!-- Testimonial Card 4 -->
                    <div class="testimonial-card p-6 rounded-xl shadow-xl flex flex-col h-full">
                        <p class="text-lg text-gray-300 italic mb-4">
                            "This website has significantly improved my speed and accuracy. The detailed questions are exactly what I needed for my preparation."
                        </p>
                        <div class="mt-auto">
                            <p class="font-semibold text-white">Arindam Das</p>
                            <p class="text-sm text-gray-400">SLST Math Aspirant</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden Quiz Sections (Initial Forms, Quiz, and Results) -->
    <div id="quiz-flow-container" class="fixed inset-0 bg-gray-100 z-50 p-4 hidden overflow-y-auto flex items-center justify-center">
        <div class="bg-white shadow-2xl rounded-xl p-6 md:p-10 w-full max-w-4xl space-y-8">
            <div class="flex justify-start">
                <button id="back-to-home" class="text-gray-500 hover:text-gray-900 transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Student Info Form (inside the hidden container) -->
            <div id="student-form-section">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Start Your Test</h1>
                <div id="message-box" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <span class="block sm:inline" id="message-text"></span>
                </div>
                <form id="student-form" class="space-y-4">
                    <div>
                        <label for="studentName" class="block text-sm font-medium text-gray-700">Name</label>
                        <input type="text" id="studentName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2" placeholder="John Doe" required>
                    </div>
                    <div>
                        <label for="mobileNumber" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                        <input type="tel" id="mobileNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2" placeholder="10-digit number" required pattern="[0-9]{10}" maxlength="10">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-lg btn-primary">Start Quiz</button>
                </form>
            </div>

            <!-- Quiz Section (Hidden by default) -->
            <div id="quiz-section" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Quiz</h2>
                    <div class="text-lg font-medium text-gray-600">Time Left: <span id="timer"></span></div>
                </div>
                <div id="quiz-container" class="space-y-6">
                    <!-- Single question will be dynamically inserted here -->
                </div>
                <div class="mt-8 flex justify-between">
                    <p id="question-counter" class="text-gray-500 text-sm font-medium"></p>
                    <button id="next-button" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-md shadow-lg btn-primary">Next Question</button>
                </div>
            </div>

            <!-- Results Section (Hidden by default) -->
            <div id="results-section" class="hidden text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Quiz Results</h2>
                <div class="space-y-4">
                    <p class="text-lg font-medium text-gray-700">Student: <span id="final-student-name" class="font-bold"></span></p>
                    <p class="text-lg font-medium text-gray-700">Mobile: <span id="final-mobile-number" class="font-bold"></span></p>
                    <p class="text-2xl font-semibold text-gray-800">Total Score: <span id="final-score" class="text-blue-600 font-extrabold text-4xl"></span></p>
                    <p id="time-taken" class="text-sm text-gray-500"></p>
                </div>
                <button id="restart-button" class="mt-8 bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-lg btn-primary">Try Again</button>
                <button id="download-pdf-button" class="mt-4 bg-green-600 text-white font-semibold py-2 px-4 rounded-md shadow-lg btn-primary">Download Scorecard</button>
            </div>
        </div>
    </div>

    <script>
        // --- Hardcoded Quiz Data ---
        const quizData = {
            duration: 30, // Test duration in minutes
            questions: [
                {
                    question: "Let $V$ be a vector space over a field $F$. A subset $S \\subset V$ is a subspace if and only if:",
                    options: [
                        "$S$ is non-empty and for any vectors $\\mathbf{u}, \\mathbf{v} \\in S$ and scalars $c, d \\in F$, the linear combination $c\\mathbf{u} + d\\mathbf{v}$ is in $S$.",
                        "$S$ contains the zero vector and is closed under vector addition.",
                        "$S$ is non-empty and for any vector $\\mathbf{u} \\in S$ and scalar $c \\in F$, the product $c\\mathbf{u}$ is in $S$.",
                        "$S$ is a subset of $V$."
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "What is the determinant of the matrix $\\begin{pmatrix} 2 & 3 \\\\ 4 & 5 \\end{pmatrix}$?",
                    options: ["$2$", "$-2$", "$22$", "$-22$"],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "A linear transformation $T: V \\to W$ is an isomorphism if it is:",
                    options: [
                        "Surjective and its kernel is non-trivial.",
                        "Injective and its image is not equal to $W$.",
                        "Both injective and surjective.",
                        "Bijective but not a homomorphism."
                    ],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "The set of all polynomials of degree at most 3 with real coefficients, denoted by $P_3(\\mathbb{R})$, forms a vector space. What is its dimension?",
                    options: ["$2$", "$3$", "$4$", "$5$"],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "Which of the following sets is a basis for $\\mathbb{R}^2$?",
                    options: [
                        "$\\{ (1, 0), (2, 0) \\}$",
                        "$\\{ (1, 1), (2, 2) \\}$",
                        "$\\{ (1, 0), (0, 1) \\}$",
                        "$\\{ (0, 0), (1, 1) \\}$"
                    ],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "What is the rank of the matrix $\\begin{pmatrix} 1 & 2 & 3 \\\\ 2 & 4 & 6 \\\\ 3 & 6 & 9 \\end{pmatrix}$?",
                    options: ["$0$", "$1$", "$2$", "$3$"],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "Let $T: \\mathbb{R}^2 \\to \\mathbb{R}^2$ be a linear transformation defined by $T(x, y) = (x+y, x-y)$. The matrix representation of $T$ with respect to the standard basis is:",
                    options: [
                        "$\\begin{pmatrix} 1 & 1 \\\\ 1 & -1 \\end{pmatrix}$",
                        "$\\begin{pmatrix} 1 & 1 \\\\ -1 & 1 \\end{pmatrix}$",
                        "$\\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$",
                        "$\\begin{pmatrix} 1 & -1 \\\\ 1 & 1 \\end{pmatrix}$"
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "Let $A$ be a $3 \\times 3$ matrix with eigenvalues $\\lambda_1=1, \\lambda_2=2, \\lambda_3=3$. What is the trace of $A$?",
                    options: ["$1$", "$2$", "$3$", "$6$"],
                    correctAnswer: 3,
                    points: 1
                },
                {
                    question: "For a square matrix $A$, if $\\det(A) = 0$, then $A$ is:",
                    options: [
                        "Invertible.",
                        "Singular.",
                        "Orthogonal.",
                        "Diagonalizable."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "The null space (or kernel) of a linear transformation $T$ is the set of all vectors $\\mathbf{v}$ such that:",
                    options: [
                        "$T(\\mathbf{v}) \\ne 0$",
                        "$T(\\mathbf{v}) = \\mathbf{0}$",
                        "$\\mathbf{v} = \\mathbf{0}$",
                        "$T(\\mathbf{v})$ is in the image of $T$."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "What is the value of $i$ in the complex numbers, where $i^2 = -1$?",
                    options: ["$i$", "$1$", "$-1$", "$\\sqrt{-1}$"],
                    correctAnswer: 3,
                    points: 1
                },
                {
                    question: "A set of vectors $\\{ \\mathbf{v}_1, \\mathbf{v}_2, \\dots, \\mathbf{v}_n \\}$ is linearly independent if the only solution to the equation $c_1\\mathbf{v}_1 + c_2\\mathbf{v}_2 + \\dots + c_n\\mathbf{v}_n = \\mathbf{0}$ is:",
                    options: [
                        "$c_1=c_2=\\dots=c_n=1$",
                        "$c_1=c_2=\\dots=c_n=0$",
                        "The vectors are orthogonal.",
                        "The vectors form a basis."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "Which of the following is an eigenvector of the matrix $\\begin{pmatrix} 2 & 0 \\\\ 0 & 3 \\end{pmatrix}$ with eigenvalue 2?",
                    options: ["$(1, 0)$", "$(0, 1)$", "$(1, 1)$", "$(2, 3)$"],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "The dimension of the row space of a matrix is equal to its:",
                    options: [
                        "Nullity.",
                        "Column space dimension.",
                        "Determinant.",
                        "Trace."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "The characteristic polynomial of a matrix $A$ is given by $p(\\lambda) = \\det(A - \\lambda I)$. The roots of this polynomial are the:",
                    options: [
                        "Determinants of submatrices.",
                        "Traces of $A$.",
                        "Eigenvalues of $A$.",
                        "Ranks of $A$."
                    ],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "If $T: V \\to W$ is a linear transformation, then the dimension of the image of $T$ is called the:",
                    options: [
                        "Rank of $T$.",
                        "Nullity of $T$.",
                        "Trace of $T$.",
                        "Determinant of $T$."
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "Which of the following is not a property of an inner product space?",
                    options: [
                        "Commutativity: $\\langle u, v \\rangle = \\langle v, u \\rangle$",
                        "Linearity in the first argument: $\\langle au+bv, w \\rangle = a\\langle u, w \\rangle + b\\langle v, w \\rangle$",
                        "Positive-definiteness: $\\langle v, v \\rangle \\ge 0$ and $\\langle v, v \\rangle = 0$ if and only if $v = 0$.",
                        "Distributivity: $\\langle u, v+w \\rangle = \\langle u, v \\rangle + \\langle u, w \\rangle$"
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "The Gram-Schmidt process is used to:",
                    options: [
                        "Find the determinant of a matrix.",
                        "Construct an orthogonal basis from a given basis.",
                        "Solve a system of linear equations.",
                        "Find the eigenvalues of a matrix."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "The geometric multiplicity of an eigenvalue $\\lambda$ is the dimension of the corresponding:",
                    options: [
                        "Eigenspace.",
                        "Null space.",
                        "Row space.",
                        "Column space."
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "A matrix $A$ is diagonalizable if and only if for every eigenvalue $\\lambda$, its algebraic multiplicity equals its:",
                    options: [
                        "Trace.",
                        "Rank.",
                        "Geometric multiplicity.",
                        "Determinant."
                    ],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "The identity matrix $I$ is a special case of a:",
                    options: [
                        "Symmetric matrix.",
                        "Diagonal matrix.",
                        "Singular matrix.",
                        "Upper triangular matrix."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "The transpose of a matrix $A$, denoted by $A^T$, is obtained by:",
                    options: [
                        "Interchanging its rows and columns.",
                        "Multiplying all elements by -1.",
                        "Taking the determinant.",
                        "Swapping the main diagonal elements."
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "For a linear system of equations $A\\mathbf{x} = \\mathbf{b}$, a unique solution exists if and only if:",
                    options: [
                        "$A$ is a square matrix.",
                        "$\\det(A) = 0$.",
                        "$A$ is invertible.",
                        "The system is homogeneous."
                    ],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "The set of all $2 \\times 2$ matrices with real entries forms a vector space. What is its dimension?",
                    options: ["$2$", "$3$", "$4$", "$5$"],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "The inverse of a $2 \\times 2$ matrix $\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}$ is $\\frac{1}{ad-bc} \\begin{pmatrix} d & -b \\\\ -c & a \\end{pmatrix}$. This inverse exists only if:",
                    options: [
                        "$a+d \\ne 0$",
                        "$ad-bc \\ne 0$",
                        "$a-d \\ne 0$",
                        "$ad+bc \\ne 0$"
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "A set of vectors that are all mutually orthogonal and have a norm of 1 is called an:",
                    options: [
                        "Orthogonal basis.",
                        "Orthonormal basis.",
                        "Linear combination.",
                        "Eigenbasis."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "The characteristic equation of a matrix $A$ is used to find its:",
                    options: [
                        "Inverse.",
                        "Rank.",
                        "Eigenvalues.",
                        "Determinant."
                    ],
                    correctAnswer: 2,
                    points: 1
                },
                {
                    question: "Let $S = \\{ (1, 0, 0), (0, 1, 0), (0, 0, 1) \\}$ be a basis for $\\mathbb{R}^3$. This basis is known as the:",
                    options: [
                        "Orthogonal basis.",
                        "Standard basis.",
                        "Non-trivial basis.",
                        "Eigenbasis."
                    ],
                    correctAnswer: 1,
                    points: 1
                },
                {
                    question: "If $\\lambda$ is an eigenvalue of a matrix $A$, then for some non-zero vector $\\mathbf{v}$, we have $A\\mathbf{v} = \\lambda \\mathbf{v}$. The vector $\\mathbf{v}$ is called an:",
                    options: [
                        "Eigenvector.",
                        "Null vector.",
                        "Row vector.",
                        "Column vector."
                    ],
                    correctAnswer: 0,
                    points: 1
                },
                {
                    question: "The condition for a matrix $A$ to be orthogonal is:",
                    options: [
                        "$A^T = A$",
                        "$A^T = -A$",
                        "$A^T A = I$",
                        "$A^T A = 0$"
                    ],
                    correctAnswer: 2,
                    points: 1
                }
            ]
        };

        // --- Global Variables (will be used by multiple functions) ---
        let timer = quizData.duration * 60;
        let countdownInterval;
        let studentName = "";
        let mobileNumber = "";
        let currentQuestionIndex = 0;
        let studentAnswers = new Array(quizData.questions.length).fill(null);
        let finalScore = 0;
        let timeTaken = 0;
        const totalPossibleScore = quizData.questions.reduce((sum, q) => sum + q.points, 0);

        // --- Utility Functions ---

        /**
         * Displays a temporary message in the message box.
         * @param {string} message The message to display.
         * @param {number} duration The duration in milliseconds to show the message.
         */
        function showMessage(message, duration = 3000) {
            const messageBox = document.getElementById("message-box");
            const messageText = document.getElementById("message-text");
            messageText.textContent = message;
            messageBox.classList.remove("hidden");
            setTimeout(() => {
                messageBox.classList.add("hidden");
            }, duration);
        }

        /**
         * Renders a single quiz question from the hardcoded quizData object.
         * @param {number} index The index of the question to render.
         */
        function renderQuestion(index) {
            if (index < 0 || index >= quizData.questions.length) {
                console.error("Invalid question index.");
                return;
            }

            const quizContainer = document.getElementById("quiz-container");
            const questionCounterElement = document.getElementById("question-counter");
            const nextButton = document.getElementById("next-button");

            const q = quizData.questions[index];
            quizContainer.innerHTML = '';
            
            const questionElement = document.createElement('div');
            questionElement.classList.add('p-6', 'bg-gray-50', 'rounded-lg', 'shadow');
            
            const questionHtml = `
                <p class="text-xl font-semibold text-gray-800 mb-4">
                    <span class="font-bold text-blue-600">Q${index + 1}:</span> 
                    ${q.question}
                </p>
                <div class="space-y-3">
                    ${q.options.map((option, optionIndex) => `
                        <label class="block">
                            <input type="radio" name="current-question" value="${optionIndex}" class="hidden" ${studentAnswers[index] === optionIndex ? 'checked' : ''} />
                            <span class="option-label text-lg font-medium text-gray-700 block transition-all duration-200 ease-in-out">
                                ${option}
                            </span>
                        </label>
                    `).join('')}
                </div>
            `;
            questionElement.innerHTML = questionHtml;
            quizContainer.appendChild(questionElement);

            questionCounterElement.textContent = `Question ${index + 1} of ${quizData.questions.length}`;

            if (index === quizData.questions.length - 1) {
                nextButton.textContent = "Submit Quiz";
            } else {
                nextButton.textContent = "Next Question";
            }

            if (window.MathJax) {
                window.MathJax.typesetPromise([quizContainer]);
            }
        }

        /**
         * Starts the quiz timer.
         */
        function startTimer() {
            const timerElement = document.getElementById("timer");
            countdownInterval = setInterval(() => {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timer > 0) {
                    timer--;
                } else {
                    clearInterval(countdownInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        /**
         * Saves the current question's answer and moves to the next question.
         */
        function nextQuestion() {
            const selectedOption = document.querySelector('input[name="current-question"]:checked');
            if (selectedOption) {
                const selectedIndex = parseInt(selectedOption.value, 10);
                studentAnswers[currentQuestionIndex] = selectedIndex;
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.questions.length) {
                renderQuestion(currentQuestionIndex);
            } else {
                submitQuiz();
            }
        }

        /**
         * Calculates the final score and displays the results.
         */
        function submitQuiz() {
            clearInterval(countdownInterval);
            let score = 0;
            quizData.questions.forEach((q, index) => {
                if (studentAnswers[index] === q.correctAnswer) {
                    score += q.points;
                }
            });

            finalScore = score;
            timeTaken = quizData.duration * 60 - timer;

            const finalStudentNameElement = document.getElementById("final-student-name");
            const finalMobileNumberElement = document.getElementById("final-mobile-number");
            const finalScoreElement = document.getElementById("final-score");
            const timeTakenElement = document.getElementById("time-taken");
            const quizSection = document.getElementById("quiz-section");
            const resultsSection = document.getElementById("results-section");

            finalStudentNameElement.textContent = studentName;
            finalMobileNumberElement.textContent = mobileNumber;
            finalScoreElement.textContent = `${finalScore} / ${totalPossibleScore}`;

            const minutesTaken = Math.floor(timeTaken / 60);
            const secondsTaken = timeTaken % 60;
            timeTakenElement.textContent = `Time taken: ${minutesTaken} min ${secondsTaken} sec`;

            quizSection.classList.add("hidden");
            resultsSection.classList.remove("hidden");
        }

        /**
         * Generates and downloads a PDF scorecard using jsPDF's html method.
         */
        function generateAndDownloadPDF() {
            window.jsPDF = window.jspdf.jsPDF;
            const pdf = new jsPDF('p', 'pt', 'a4'); // Use 'pt' unit for better control

            // Create the HTML content with inline styles
            const pdfContentHTML = `
                <div style="font-family: 'Inter', sans-serif; padding: 40px; text-align: center; width: 100%;">
                    <h1 style="font-size: 32px; font-weight: 800; color: white; background-image: linear-gradient(to right, #4c1d95, #3b0764); padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 24px;">
                        WBSLST 2025 Mock Test Portal
                    </h1>
                    <div style="background-color: #4c1d95; padding: 24px; border: 2px solid #5a2e9e; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);">
                        <h2 style="font-size: 28px; font-weight: 700; color: white; margin-bottom: 16px; text-align: center;">Scorecard</h2>
                        <div style="display: flex; flex-direction: column; gap: 16px; text-align: left;">
                            <p style="font-size: 18px; font-weight: 500; color: white;">Name: <span style="font-weight: 700;">${studentName}</span></p>
                            <p style="font-size: 18px; font-weight: 500; color: white;">Mobile Number: <span style="font-weight: 700;">${mobileNumber}</span></p>
                            <p style="font-size: 24px; font-weight: 600; color: white;">Total Score: <span style="font-weight: 800; color: rgb(250, 204, 21);">${finalScore} / ${totalPossibleScore}</span></p>
                        </div>
                    </div>
                    <div style="margin-top: 32px; text-align: center; color: #6b7280; font-style: italic;">
                        <p style="font-size: 16px;">Best wishes for your future endeavors!</p>
                    </div>
                </div>
            `;
            
            pdf.html(pdfContentHTML, {
                callback: function (pdf) {
                    pdf.save(`WBSLST_Scorecard_${studentName}.pdf`);
                },
                x: 10,
                y: 10,
                width: 570, // Set the width to a reasonable value for A4
                windowWidth: 700 // Set the virtual window width for rendering
            });
        }

        /**
         * Resets the quiz and returns to the main dashboard.
         */
        function resetQuizAndReturn() {
            const mainDashboardSection = document.getElementById("main-dashboard-section");
            const quizFlowContainer = document.getElementById("quiz-flow-container");
            const quizContainer = document.getElementById("quiz-container");
            const studentForm = document.getElementById("student-form");
            const resultsSection = document.getElementById("results-section");
            const quizSection = document.getElementById("quiz-section");
            const studentFormSection = document.getElementById("student-form-section");

            clearInterval(countdownInterval);
            timer = quizData.duration * 60;
            quizContainer.innerHTML = '';
            studentForm.reset();
            currentQuestionIndex = 0;
            studentAnswers = new Array(quizData.questions.length).fill(null);

            quizFlowContainer.classList.add("hidden");
            mainDashboardSection.classList.remove("hidden");

            resultsSection.classList.add("hidden");
            quizSection.classList.add("hidden");
            studentFormSection.classList.remove("hidden");
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const mainDashboardSection = document.getElementById("main-dashboard-section");
            const quizFlowContainer = document.getElementById("quiz-flow-container");
            const studentFormSection = document.getElementById("student-form-section");
            const studentForm = document.getElementById("student-form");
            const quizSection = document.getElementById("quiz-section");
            const nextButton = document.getElementById("next-button");
            const restartButton = document.getElementById("restart-button");
            const startTestButton = document.getElementById('start-test-button');
            const backToHomeButton = document.getElementById("back-to-home");
            const downloadPdfButton = document.getElementById("download-pdf-button");

            // --- Event Listeners ---

            // Handle click on the main "Start Free Mock Test" button
            // Check if the button element exists before adding the listener
            if (startTestButton) {
                console.log("Start Test button found. Attaching event listener.");
                startTestButton.addEventListener('click', () => {
                    console.log("Start Test button clicked.");
                    mainDashboardSection.classList.add("hidden");
                    quizFlowContainer.classList.remove("hidden");
                });
            } else {
                console.error("Start Test button not found in the DOM.");
            }

            // Handle student form submission (inside the quiz flow)
            studentForm.addEventListener("submit", (e) => {
                e.preventDefault();
                studentName = document.getElementById("studentName").value.trim();
                mobileNumber = document.getElementById("mobileNumber").value.trim();

                if (studentName && mobileNumber.length === 10 && !isNaN(mobileNumber)) {
                    studentFormSection.classList.add("hidden");
                    quizSection.classList.remove("hidden");

                    currentQuestionIndex = 0;
                    studentAnswers = new Array(quizData.questions.length).fill(null);
                    renderQuestion(currentQuestionIndex);
                    startTimer();
                } else {
                    showMessage("Please enter your name and a valid 10-digit mobile number to start the quiz.");
                }
            });

            // Handle next/submit button click
            nextButton.addEventListener("click", () => {
                nextQuestion();
            });

            // Handle the "Try Again" button on the results screen
            restartButton.addEventListener("click", () => {
                timer = quizData.duration * 60;
                currentQuestionIndex = 0;
                studentAnswers = new Array(quizData.questions.length).fill(null);
                
                document.getElementById("results-section").classList.add("hidden");
                document.getElementById("student-form-section").classList.remove("hidden");
            });

            // Handle the "Download Scorecard" button
            downloadPdfButton.addEventListener("click", () => {
                generateAndDownloadPDF();
            });

            // Handle the "Back" button to return to the dashboard
            backToHomeButton.addEventListener("click", () => {
                resetQuizAndReturn();
            });
        });
    </script>
</body>
</html>
